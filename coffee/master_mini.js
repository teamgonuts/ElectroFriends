(function(){var a,b,c,d,e,f,g;window.Player=c=function(){function a(){this.initializePlayer();this.previousSongs=new Array;this.songsToRemember=10}a.prototype.initializePlayer=function(){var a,b;a=false;if(a)console.log("Player.initializePlayer()");b={allowScriptAccess:"always"};swfobject.embedSWF("http://www.youtube.com/v/"+$("#ytcode_1").val()+"&enablejsapi=1&playerapiid=ytplayer"+"&hd=1&iv_load_policy=3&rel=0&showinfo=0&autohide=1","ytplayer","275","90","8",null,null,b);this.loadSongInRankings(1);return this.resizeMaxQueue()};a.prototype.resizeMaxQueue=function(){var a;a=$(window).height()-12-$("#bottomControls").height();return $("#max-queue").height(a)};a.prototype.loadSongInRankings=function(a){var b;b=false;if(b)console.log("loadSongInRankings Called()");window.currentSong=new f($("#ytcode_"+a).val(),$("#title_"+a).val(),$("#genre_"+a).val(),$("#artist_"+a).val(),$("#user_"+a).val(),$("#userScore_"+a).val());return this.updateCurrentSongInfo()};a.prototype.loadSongInQueue=function(a){var b;b=false;if(b)console.log("loadSongInQueue Called("+a+")");window.currentSong=new f(window.queue.userQ.songs[a].ytcode,window.queue.userQ.songs[a].title,window.queue.userQ.songs[a].genre,window.queue.userQ.songs[a].artist,window.queue.userQ.songs[a].user,window.queue.userQ.songs[a].userScore);return this.updateCurrentSongInfo()};a.prototype.addToHistory=function(a){var b;b=false;if(b)console.log("adding "+a.title+" to song history");this.previousSongs.push(a);if(this.previousSongs.length>this.songsToRemember){return this.previousSongs.shift()}};a.prototype.previousSong=function(){var a,b;a=false;if(a)console.log("player.previousSong()");if(this.previousSongs.length>0){window.currentSong=this.previousSongs.pop();this.updateCurrentSongInfo();b=document.getElementById("ytplayer");return b.loadVideoById(currentSong.ytcode)}};a.prototype.updateCurrentSongInfo=function(){var a;a=false;if(a)console.log("player.updateCurrentSongInfo()");$("#currentSongTitle").html(window.currentSong.title);$("#currentSongArtist").html(window.currentSong.artist);$("#currentSongGenre").html(window.currentSong.genre);return $("#currentSongUser").html(window.currentSong.user+" ("+window.currentSong.userScore+")")};return a}();window.onYouTubePlayerReady=function(a){var b,c;b=false;if(b)console.log("player ready");c=document.getElementById(a);c.addEventListener("onStateChange","stateChange");return c.addEventListener("onError","onPlayerError")};window.stateChange=function(a){var b;b=false;if(b)console.log("Player State Change: "+a);switch(a){case 0:if(b)console.log("Song Ended");$(".next-song").click();break;case 1:if(b)console.log("Song Playing");incrementPlayCount();return document.title=$("#currentSongTitle").html()+" by "+$("#currentSongArtist").html();case 2:if(b)console.log("Song Paused");return document.title="Paused - t3k.no";case 3:if(b)console.log("Song Loading");return document.title="Loading Song - t3k.no"}};window.incrementPlayCount=function(){var a,b,c,d,e;b=false;e=document.getElementById("ytplayer");c=e.getVideoUrl().split("v=")[1];a=c.indexOf("&");if(a!==-1){d=c.substring(0,a)}if(b){console.log("window.incrementPlayCount("+d+"), currentSong.played: "+window.currentSong.played)}if(!window.currentSong.played){window.currentSong.played=true;return $.post("ajax/incrementPlayCount.php",{ytcode:d},function(a){if(b)return console.log(" Successfully Incremented Play Count!")})}};window.onPlayerError=function(a){var b;b=false;if(b)console.log("onPlayerError() called!");$(".next-song").click()};window.Song=f=function(){function a(a,b,c,d,e,f){var g;this.ytcode=a;this.title=b;this.genre=c;this.artist=d;this.user=e;this.userScore=f;this.played=false;g=false;if(g){console.log("Song Created! ytcode: "+this.ytcode+", title: "+this.title+", genre: "+this.genre+", artist: "+this.artist+", userScore: "+this.userScore+", user: "+this.user)}}return a}();window.Queue=d=function(){function a(){this.genQ=new b;this.userQ=new g;this.minQ_MaxSongs=3;this.initialize()}a.prototype.initialize=function(){this.genQ.refresh();return this.updateMinQueue()};a.prototype.updateMinQueue=function(a){var b,c,d,e;if(a==null)a=false;b=false;if(b)console.log("Queue.updateMinQueue() called!");$("#min-queue").html("");if($("#userQ").find(".queue-item").length!==0){for(c=0,d=$("#userQ").find(".queue-item").length-1;0<=d?c<=d:c>=d;0<=d?c++:c--){if(b)console.log("Adding Song from UserQ");if($("#min-queue").find(".queue-item").length>=this.minQ_MaxSongs){break}if(!this.userQ.songs[c].played){$("#min-queue").append(' <li class="queue-item" id="userQ_'+(c+1)+'_2"><span class="title"> '+this.userQ.songs[c].title+'</span><span class="purple"> //</span> '+this.userQ.songs[c].artist)}}}if(a){c=1}else{c=parseInt(this.genQ.curSong)+1}if(b)console.log("@genQ.curSong="+this.genQ.curSong);e=[];while($("#genQ_"+c).html()!==null&&$("#min-queue").find(".queue-item").length<this.minQ_MaxSongs){if(b)console.log("Next song to add: "+c);if(b)console.log("Adding Song from GenQ: "+$("#genQ_"+c).html());$("#min-queue").append(' <li class="queue-item" id="genQ_'+c+'_2"><span class="title"> '+$("#title_"+c).val()+'</span><span class="purple"> //</span> '+$("#artist_"+c).val()+"</li>");e.push(c++)}return e};a.prototype.playSong=function(a,b){var c,d,e,f;c=false;if(c)console.log("Play Song "+b+" in "+a);if(a!=="genQ"&&a!=="userQ"){console.log("Queue.playSong ERROR: Invalid param queue: "+a);return}if(b<1||b>$("#"+a).find(".queue-item").length){console.log("Queue.playSong ERROR: Index out of bounds: "+b);return}$(".queue-item").removeClass("selected-song");$("#"+a+"_"+b).addClass("selected-song");window.player.addToHistory(window.currentSong);if(a==="genQ"){e=$("#ytcode_"+b).val();window.player.loadSongInRankings(b);this.genQ.curSong=b;if(c)console.log("@genQ.curSong="+this.genQ.curSong);this.userQ.markAllPlayed()}else{d=b-1;e=this.userQ.songs[d].ytcode;window.player.loadSongInQueue(d);this.userQ.songs[d].played=true;this.userQ.markAllNotPlayed(d)}this.updateMinQueue();if(c)console.log("  about to play song with ytcode: "+e);f=document.getElementById("ytplayer");return f.loadVideoById(e)};return a}();window.UserQueue=g=function(){function a(){var a;a=false;if(a)console.log("User Queue Created!");this.songs=new Array}a.prototype.append=function(a){this.songs.push(new f($("#ytcode_"+a).val(),$("#title_"+a).val(),$("#genre_"+a).val(),$("#artist_"+a).val(),$("#user_"+a).val(),$("#userScore_"+a).val()));return $("#userQ").append(' <li class="queue-item user-queue" id="userQ_'+this.songs.length+'"><span class="title"> '+$("#title_"+a).val()+'</span><span class="purple"> //</span> '+$("#artist_"+a).val()+'<span class="hidden delete-song">[x]</span>')};a.prototype["delete"]=function(a){var b,c,d,e,f;b=false;if(b)console.log("UserQueue.delete("+a+")");$("#userQ_"+a).remove();this.songs.splice(a-1,1);a=1;f=$("#userQ").children();for(d=0,e=f.length;d<e;d++){c=f[d];$(c).attr("id","userQ_"+a);a++;if(b)console.log($(c).attr("id")+", i="+a)}return queue.updateMinQueue()};a.prototype.clear=function(){var a;a=false;if(a)console.log("UserQueue.clear() called!");return this.initialize()};a.prototype.markAllPlayed=function(){var a,b,c,d,e,f;a=false;if(a)console.log("UserQueue.markAllPlayed() called!");e=this.songs;f=[];for(c=0,d=e.length;c<d;c++){b=e[c];f.push(b.played=true)}return f};a.prototype.markAllNotPlayed=function(a){var b,c,d,e;b=false;if(b)console.log("UserQueue.markAllNotPlayed("+a+") called!");if($("#userQ").children().length>1){e=[];for(c=0,d=this.songs.length-1;0<=d?c<=d:c>=d;0<=d?c++:c--){if(c<=a){this.songs[c].played=true;if(b){e.push(console.log(this.songs[c].title+" played: "+this.songs[c].played))}else{e.push(void 0)}}else if(c>a&&c<=this.songs.length-1){this.songs[c].played=false;if(b){e.push(console.log(this.songs[c].title+" played: "+this.songs[c].played))}else{e.push(void 0)}}else{}}return e}};return a}();window.GeneratedQueue=b=function(){function a(){var a;a=false;if(a)console.log("Generated Queue Created!");this.songs=new Array;this.curSong=0}a.prototype.refresh=function(a){var b,c,d,e;if(a==null)a=true;b=false;this.clear();if(b)console.log("refresh("+a+").@curSong="+this.curSong);if(a)this.curSong=1;e=[];for(c=1,d=$(".song-max").length;1<=d?c<=d:c>=d;1<=d?c++:c--){this.songs.push(c);e.push($("#genQ").append(' <li class="queue-item" id="genQ_'+c+'"><span class="title"> '+$("#title_"+c).val()+'</span><span class="purple"> //</span> '+$("#artist_"+c).val()+"</li>"))}return e};a.prototype.clear=function(){var a;a=false;if(a)console.log("GenQueue.clear() called!");return $("#genQ").html("")};return a}();window.Filters=a=function(){function a(a,b,c,d){this.genre=a!=null?a:"all";this.time=b!=null?b:"new";this.artist=c!=null?c:"";this.user=d!=null?d:"";this.highlight()}a.prototype.isSet=function(a){var b;return((b=this.filt(a))!=null?b.length:void 0)>0};a.prototype.filt=function(a){if(a==="genre"){return this.genre}else if(a==="time"){return this.time}else if(a==="artist"){return this.artist}else if(a==="user"){return this.user}else{return false}};a.prototype.set=function(a,b){if(a==="genre"){this.genre=b;$(".genre-filter").removeClass("highlight-filter");return $("#filter-"+b).addClass("highlight-filter")}else if(a==="time"){this.time=b;$(".time-filter").removeClass("highlight-filter");return $("#filter-"+b).addClass("highlight-filter")}else if(a==="artist"){return this.artist=b}else if(a==="user"){return this.user=b}else{return false}};a.prototype.highlight=function(){if(this.genre==="all"){$("#filter-all").addClass("highlight-filter")}else if(this.genre==="dnb"){$("#filter-dnb").addClass("highlight-filter")}else if(this.genre==="dubstep"){$("#filter-dubstep").addclass("highlight-filter")}else if(this.genre==="electro"){$("#filter-electro").addclass("highlight-filter")}else if(this.genre==="hardstyle"){$("#filter-hardstyle").addclass("highlight-filter")}else if(this.genre==="house"){$("#filter-house").addclass("highlight-filter")}else if(this.genre==="trance"){$("#filter-trance").addclass("highlight-filter")}if(this.time==="day"){return $("#filter-day").addclass("highlight-filter")}else if(this.time==="week"){return $("#filter-week").addclass("highlight-filter")}else if(this.time==="month"){return $("#filter-month").addclass("highlight-filter")}else if(this.time==="year"){return $("#filter-year").addclass("highlight-filter")}else if(this.time==="century"){return $("#filter-century").addclass("highlight-filter")}};return a}();window.Rankings=e=function(){function b(){this.filters=new a;this.maxed_song=-1;this.songsPerPage=$("tr.song-min").length;this.commentsPerSong=4;this.flag="normal";this.initialize()}b.prototype.initialize=function(){return this.initializeSongs(1,this.songsPerPage)};b.prototype.update=function(){var a;a=false;if(a)console.log("Rankings.update()");this.refreshTitle();return $.post("ajax/rankingsAjax.php",{genrefilter:rankings.filt("genre"),timefilter:rankings.filt("time")},function(a){$("#rankings-table").html(a);rankings.initialize();rankings.flag="normal";queue.genQ.refresh();return queue.updateMinQueue(true)})};b.prototype.filt=function(a){return this.filters.filt(a)};b.prototype.nextComments=function(a){var b,c,d,e;c=false;if(c)console.log("Rankings.nextComments("+a+")");e=parseInt($("#commentIterator_"+a).val());b=this.commentsPerSong;d=e+this.commentsPerSong;$("#commentIterator_"+a).val(d);if(c){console.log("POSTS: ");console.log("lowerLimit: "+e);console.log("upperLimit: "+d);console.log("ytcode: "+$("#ytcode_"+a).val())}return $.post("ajax/nextCommentAjax.php",{lowerLimit:e,upperLimit:d,ytcode:$("#ytcode_"+a).val()},function(d){if(c)console.log(d);$("#max_"+a).find(".comment-display").html(d);if($("#max_"+a).find(".comment-p").length<b){return $("#max_"+a).find(".see-more-comments").addClass("hidden")}})};b.prototype.enableMoreSongsButton=function(){if($("tr.song-min").length>0&&$("tr.song-min").length%this.songsPerPage===0){$("#showMoreSongs").removeClass("hidden");return true}else{$("#showMoreSongs").addClass("hidden");return false}};b.prototype.changeTitle=function(a){return $("#rankings-title").text(a)};b.prototype.submitComment=function(a,b,c){var d,e;if(c==null)c=-1;d=false;if(d){console.log("User "+b+" commenting on "+c+": "+a)}if(a===""){return alert("Please enter a comment")}else if(b===""){return alert("Please enter a username to comment")}else{if(c!==-1){e=$("#ytcode_"+c).val()}else{e=$("#upload_yturl").val()}if(d)console.log("POSTS:");if(d)console.log(encodeURIComponent(b));if(d)console.log(encodeURIComponent(a));if(d)console.log("ytcode: "+e);return $.post("ajax/commentAjax.php",{user:encodeURIComponent(b),comment:encodeURIComponent(a),ytcode:e},function(a){if(d)console.log("Data: "+a);if(c!==-1){if(!$("#max_"+c).find(".no-comment").hasClass("hidden")){$("#max_"+c).find(".no-comment").addClass("hidden")}return $("#max_"+c).find(".comment-display").prepend(a)}})}};b.prototype.refreshTitle=function(){var a,b;if(this.filt("genre")==="all"){a="Tracks"}else{a=this.filt("genre")}if(a==="Tracks"&&this.filt("time")==="new"){b="The Fresh List"}else if(this.filt("time")==="new"){b="The Freshest "+a}else{b="Top "+a+" of the "+this.filt("time")}return $("#rankings-title").text(b)};b.prototype.initializeSongs=function(a,b){var c,d,e;c=false;this.enableMoreSongsButton();if(c){console.log("Rankings.initializeComments("+a+","+b+") called")}e=[];for(d=a;a<=b?d<=b:d>=b;a<=b?d++:d--){if(c){console.log("Comments on Song "+d+": "+$("#max_"+d).find(".comment-p").length)}if($("#max_"+d).find(".comment-p").length<this.commentsPerSong){$("#max_"+d).find(".see-more-comments").addClass("hidden")}if($("#max_"+d).find(".comment-p").length===0){e.push($("#max_"+d).find(".comment-display").html('<p class="no-comment">No Comments. </p>'))}else{e.push(void 0)}}return e};b.prototype.search=function(a){var b,c,d;c=false;d=this.songsPerPage;b=this.commentsPerSong;a=a.trim();if(a.length===0){return alert("Please enter a search term")}else{if(c)console.log("search:"+a);this.changeTitle("Searching: "+a);this.flag="search";return $.post("ajax/searchAjax.php",{searchTerm:a,upperLimit:d},function(a){var c,e,f;$("#rankings-table").html(a);if($("tr.song-min").length>0&&$("tr.song-min").length%d===0){$("#showMoreSongs").removeClass("hidden")}else{$("#showMoreSongs").addClass("hidden")}if($("tr.song-min").length>0){f=[];for(c=1,e=$("tr.song-min").length;1<=e?c<=e:c>=e;1<=e?c++:c--){if($("#max_"+c).find(".comment-p").length===0){$("#max_"+c).find(".comment-display").html('<p class="no-comment">No Comments. </p>')}if($("#max_"+c).find(".comment-p").length<b){f.push($("#max_"+c).find(".see-more-comments").addClass("hidden"))}else{f.push(void 0)}}return f}})}};return b}();$(function(){window.player=new c;window.queue=new d;window.rankings=new e;$(window).resize(function(){var a;a=false;if(a)console.log("resized window");return player.resizeMaxQueue()});$(document).on("click",".song-button",function(){var a;a=$(this).closest(".song").attr("id").split("_")[1];if($(this).hasClass("play-button")){return queue.playSong("genQ",a)}else if($(this).hasClass("queue-button")){queue.userQ.append(a);return queue.updateMinQueue()}});$(document).on("hover",".user-queue",function(){return $(this).find(".delete-song").toggleClass("hidden")});$(document).on("click",".delete-song",function(a){var b,c;b=false;if(b)console.log("delete-song clicked");c=$(this).closest(".queue-item").attr("id").split("_")[1];queue.userQ["delete"](c);return a.stopPropagation()});$(document).on("click",".next-song",function(){var a,b,c,d;a=false;if(a){console.log($("#min-queue").find(".queue-item:first-child").html())}c=$("#min-queue").find(".queue-item:first-child").attr("id");b=c.split("_")[1];d=c.split("_")[0];if(a)console.log("queue: "+d+", index: "+b);return queue.playSong(d,b)});$(document).on("click",".previous-song",function(){return player.previousSong()});$(document).on("click",".queue-item",function(){var a,b,c;a=false;if(a)console.log("queue-item clicked");b=$(this).attr("id").split("_")[1];c=$(this).attr("id").split("_")[0];if(a)console.log("queue: "+c+", index: "+b);return queue.playSong(c,b)});$(".filter").click(function(){if($(this).hasClass("genre-filter")){rankings.filters.set("genre",$(this).html().toLowerCase())}else{rankings.filters.set("time",$(this).html().toLowerCase())}return rankings.update()});$("#fresh-list").click(function(){rankings.filters.set("time","new");rankings.filters.set("genre","all");return rankings.update()});$(document).on("click",".song",function(){var a,b,c;c=$(this).attr("id").split("_");a=c[1];b=c[0];if(b==="min"){if(rankings.maxed_song!==-1){$("#max_"+rankings.maxed_song).addClass("hidden");$("#min_"+rankings.maxed_song).removeClass("hidden")}else{}$("#min_"+a).addClass("hidden");$("#max_"+a).removeClass("hidden");return rankings.maxed_song=a}});$(document).on("click",".queue-min",function(){$("#max-queue").addClass("hidden");$(".content").removeClass("queue-open");return $("#queue-max").html("[Show Queue]")});$(document).on("click","#queue-max",function(){if($("#max-queue").hasClass("hidden")){$("#max-queue").removeClass("hidden");$(".content:not(#bottom-contents)").addClass("queue-open");return $("#queue-max").html("[Close Queue]")}else{return $(".queue-min").click()}});$(document).on("click","#showMoreSongs",function(){var a;a=$("tr.song-min").length;return $.post("ajax/showMoreSongsAjax.php",{genrefilter:rankings.filt("genre"),timefilter:rankings.filt("time"),searchTerm:$("#search-input").val(),flag:rankings.flag,lowerLimit:a,upperLimit:$("tr.song-min").length+rankings.songsPerPage},function(b){$("#rankings-table").append(b);rankings.initializeSongs(a,a+rankings.songsPerPage);queue.genQ.refresh(false);return queue.updateMinQueue()})});$(document).on("click",".submit-comment",function(){var a;a=$(this).closest(".song").attr("id").split("_")[1];return rankings.submitComment($("#max_"+a).find(".comment-text").val(),$("#max_"+a).find(".comment-user").val(),a)});$(document).on("click",".see-more-comments",function(){var a;a=false;if(a)console.log("See-More-Comments Clicked");return rankings.nextComments($(this).closest(".song").attr("id").split("_")[1])});$(document).on("click",".vote-button",function(){var a,b,c,d;a=false;if(!$(this).hasClass("highlight-vote")){b=$(this).closest(".song").attr("id").split("_")[1];if($(this).attr("id")==="up-vote"){if(a)console.log("UpVote called on "+b);c="up";d=1;$("#max_"+b).find("#up-vote").addClass("highlight-vote");$("#max_"+b).find("#down-vote").removeClass("highlight-vote")}else if($(this).attr("id")==="down-vote"){if(a)console.log("DownVote called on "+b);c="down";d=-1;$("#max_"+b).find("#down-vote").addClass("highlight-vote");$("#max_"+b).find("#up-vote").removeClass("highlight-vote")}else{if(a){console.log("Error: Something went wrong with the vote-buttons")}c="error"}return $.post("ajax/voteAjax.php",{result:c,ytcode:$("#ytcode_"+b).val(),user:$("#user_"+b).val(),score:$("#score_"+b).val(),ups:$("#ups_"+b).val(),downs:$("#downs_"+b).val()},function(c){var e;if(a)console.log("Vote Success: "+c);$("#max_"+b).find(".score-container").html(c);$("#min_"+b).find(".score-container").html(c);e=parseInt($("#max_"+b).find(".user-score").html());return $("#max_"+b).find(".user-score").html(e+d)})}});$("#search-button").click(function(){return rankings.search($("#search-input").val())});$(document).on("click",".search-filter",function(){return rankings.search($(this).html())});return $("#upload_song").click(function(){var a;a=false;return $.post("ajax/uploadAjax.php",{ytcode:$("#upload_yturl").val(),title:$("#upload_title").val(),oldie:$("#upload_oldie").attr("checked"),artist:$("#upload_artist").val(),genre:$("#upload_genre").val(),user:$("#upload_user").val()},function(b){console.log("Upload Result: "+b);$("#upload-box-result").html(b);$("#upload-box-result").removeClass("hidden");if($("#upload-box-result").html().indexOf("Upload Failed")===-1){$("#upload-box-result").css("color","#33FF33");if(a)console.log("comment: "+$("#upload_comment").val());if($("#upload_comment").val()!==""){rankings.submitComment($("#upload_comment").val(),$("#upload_user").val(),-1)}$("#upload_yturl").val("");$("#upload_title").val("");$("#upload_artist").val("");return $("#upload_comment").val("")}else{return $("#upload-box-result").css("color","red")}})})})}).call(this)
