(function(){var a,b,c,d,e,f,g;window.Player=c=function(){function a(){this.initializePlayer()}a.prototype.initializePlayer=function(){var a,b;a=false;if(a)console.log("Player.initializePlayer()");b={allowScriptAccess:"always"};swfobject.embedSWF("http://www.youtube.com/v/"+$("#ytcode_1").val()+"&enablejsapi=1&playerapiid=ytplayer"+"&hd=1&iv_load_policy=3&rel=0&showinfo=0&autohide=1","ytplayer","275","90","8",null,null,b);return this.loadSongInRankings(1)};a.prototype.test=function(){return alert("hi!")};a.prototype.loadSongInRankings=function(a){var b;b=false;if(b)console.log("loadSong Called()");$("#currentSongTitle").html($("#title_"+a).val());$("#currentSongArtist").html($("#artist_"+a).val());$("#currentSongGenre").html($("#genre_"+a).val());return $("#currentSongUser").html($("#user_"+a).val())};a.prototype.loadSongInfo=function(a,b,c,d){var e;e=false;if(e)console.log("loadSong Called()");$("#currentSongTitle").html(a);$("#currentSongArtist").html(b);$("#currentSongGenre").html(c);return $("#currentSongUser").html(d)};return a}();window.onYouTubePlayerReady=function(a){var b,c;b=false;if(b)console.log("player ready");c=document.getElementById(a);c.addEventListener("onStateChange","stateChange");return c.addEventListener("onError","onPlayerError")};window.stateChange=function(a){var b;b=false;if(b)console.log("Player State Change: "+a);switch(a){case 0:if(b)console.log("Song Ended");$(".next-song").click();break;case 1:if(b)console.log("Song Playing");return document.title=$("#currentSongTitle").html()+" by "+$("#currentSongArtist").html();case 2:if(b)console.log("Song Paused");return document.title="Paused - T3K.NO";case 3:if(b)console.log("Song Loading");return document.title="Loading Song - T3K.NO"}};window.onPlayerError=function(a){var b,c;b=false;if(b)console.log("onPlayerError() called!");c={allowScriptAccess:"always"};return swfobject.embedSWF("http://www.youtube.com/v/"+$("#ytcode_1").val()+"&enablejsapi=1&playerapiid=ytplayer"+"&hd=1&iv_load_policy=3&autoplay=1&rel=0&showinfo=0&autohide=1","ytplayer","275","90","8",null,null,c)};window.Song=f=function(){function a(a,b,c,d,e){var f;this.ytcode=a;this.title=b;this.genre=c;this.artist=d;this.user=e;this.played=false;f=false;if(f){console.log("Song Created! ytcode: "+this.ytcode+", title: "+this.title+", genre: "+this.genre+", artist: "+this.artist+", user: "+this.user)}}return a}();window.Queue=d=function(){function a(){this.genQ=new b;this.userQ=new g;this.curQueue="genQ";this.curSong=1;this.minQ_MaxSongs=3;this.initialize()}a.prototype.initialize=function(){this.genQ.refresh();$("#"+this.curQueue+"_"+this.curSong).addClass("selected-song");return this.updateMinQueue()};a.prototype.updateMinQueue=function(a){var b,c,d,e;if(a==null)a=false;b=false;if(b)console.log("Queue.updateMinQueue() called!");$("#min-queue").html("");if($("#userQ").find(".queue-item").length!==0){for(c=0,d=$("#userQ").find(".queue-item").length-1;0<=d?c<=d:c>=d;0<=d?c++:c--){if(b)console.log("Adding Song from UserQ");if($("#min-queue").find(".queue-item").length>=this.minQ_MaxSongs){break}if(!this.userQ.songs[c].played){$("#min-queue").append(' <li class="queue-item" id="userQ_'+(c+1)+'_2"><span class="title"> '+this.userQ.songs[c].title+'</span><span class="purple"> //</span> '+this.userQ.songs[c].artist)}}}if(a){c=1}else{c=parseInt(this.genQ.curSong)+1}e=[];while($("#genQ_"+c).html()!==null&&$("#min-queue").find(".queue-item").length<this.minQ_MaxSongs){if(b)console.log("Next song to add: "+c);if(b)console.log("Adding Song from GenQ: "+$("#genQ_"+c).html());$("#min-queue").append(' <li class="queue-item" id="genQ_'+c+'_2"><span class="title"> '+$("#title_"+c).val()+'</span><span class="purple"> //</span> '+$("#artist_"+c).val()+"</li>");e.push(c++)}return e};a.prototype.playSong=function(a,b){var c,d,e,f,g,h,i;c=false;if(c)console.log("Play Song "+b+" in "+a);if(a!=="genQ"&&a!=="userQ"){console.log("Queue.playSong ERROR: Invalid param queue: "+a);return}if(b<1||b>$("#"+a).find(".queue-item").length){console.log("Queue.playSong ERROR: Index out of bounds: "+b);return}this.curQueue=a;this.curSong=b;$(".queue-item").removeClass("selected-song");$("#"+a+"_"+b).addClass("selected-song");if(a==="genQ"){e=$("#ytcode_"+b).val();this.genQ.curSong=b;this.userQ.markAllPlayed()}else{e=this.userQ.songs[b-1].ytcode;this.userQ.songs[b-1].played=true;if(c){i=this.userQ.songs;for(g=0,h=i.length;g<h;g++){d=i[g];console.log(d.title(".played: "+d.played))}}this.userQ.markAllNotPlayed(b)}if(c)console.log("  about to play song with ytcode: "+e);f=document.getElementById("ytplayer");f.loadVideoById(e);return this.updateMinQueue()};return a}();window.UserQueue=g=function(){function a(){var a;a=false;if(a)console.log("User Queue Created!");this.songs=new Array}a.prototype.append=function(a){this.songs.push(new f($("#ytcode_"+a).val(),$("#title_"+a).val(),$("#genre_"+a).val(),$("#artist_"+a).val(),$("#user_"+a).val()));return $("#userQ").append(' <li class="queue-item" id="userQ_'+this.songs.length+'"><span class="title"> '+$("#title_"+a).val()+'</span><span class="purple"> //</span> '+$("#artist_"+a).val())};a.prototype.clear=function(){var a;a=false;if(a)console.log("UserQueue.clear() called!");return this.initialize()};a.prototype.markAllPlayed=function(){var a,b,c,d,e,f;a=false;if(a)console.log("UserQueue.markAllPlayed() called!");e=this.songs;f=[];for(c=0,d=e.length;c<d;c++){b=e[c];f.push(b.played=true)}return f};a.prototype.markAllNotPlayed=function(a){var b,c,d,e,f;b=false;if(b)console.log("UserQueue.markAllNotPlayed("+a+") called!");if(a+1<=this.songs.length-1){f=[];for(c=d=a+1,e=this.songs.length-1;d<=e?c<=e:c>=e;d<=e?c++:c--){if(b){console.log("i: "+c+", @songs.length-1: "+(this.songs.length-1))}this.songs[c].played=false;if(b){f.push(console.log(this.songs[c].title+" played: "+this.songs[c].played))}else{f.push(void 0)}}return f}};return a}();window.GeneratedQueue=b=function(){function a(){var a;a=false;if(a)console.log("Generated Queue Created!");this.songs=new Array;this.curSong=1}a.prototype.refresh=function(){var a,b,c;this.clear();this.curSong=1;c=[];for(a=1,b=$(".song-max").length;1<=b?a<=b:a>=b;1<=b?a++:a--){this.songs.push(a);c.push($("#genQ").append(' <li class="queue-item" id="genQ_'+a+'"><span class="title"> '+$("#title_"+a).val()+'</span><span class="purple"> //</span> '+$("#artist_"+a).val()+"</li>"))}return c};a.prototype.clear=function(){var a;a=false;if(a)console.log("GenQueue.clear() called!");return $("#genQ").html("")};return a}();window.Filters=a=function(){function a(a,b,c,d){this.genre=a!=null?a:"all";this.time=b!=null?b:"new";this.artist=c!=null?c:"";this.user=d!=null?d:"";this.highlight()}a.prototype.isSet=function(a){var b;return((b=this.filt(a))!=null?b.length:void 0)>0};a.prototype.filt=function(a){if(a==="genre"){return this.genre}else if(a==="time"){return this.time}else if(a==="artist"){return this.artist}else if(a==="user"){return this.user}else{return false}};a.prototype.set=function(a,b){if(a==="genre"){this.genre=b;$(".genre-filter").removeClass("highlight-filter");return $("#filter-"+b).addClass("highlight-filter")}else if(a==="time"){this.time=b;$(".time-filter").removeClass("highlight-filter");return $("#filter-"+b).addClass("highlight-filter")}else if(a==="artist"){return this.artist=b}else if(a==="user"){return this.user=b}else{return false}};a.prototype.highlight=function(){if(this.genre==="all"){$("#filter-all").addClass("highlight-filter")}else if(this.genre==="dnb"){$("#filter-dnb").addClass("highlight-filter")}else if(this.genre==="dubstep"){$("#filter-dubstep").addclass("highlight-filter")}else if(this.genre==="electro"){$("#filter-electro").addclass("highlight-filter")}else if(this.genre==="hardstyle"){$("#filter-hardstyle").addclass("highlight-filter")}else if(this.genre==="house"){$("#filter-house").addclass("highlight-filter")}else if(this.genre==="trance"){$("#filter-trance").addclass("highlight-filter")}if(this.time==="day"){return $("#filter-day").addclass("highlight-filter")}else if(this.time==="week"){return $("#filter-week").addclass("highlight-filter")}else if(this.time==="month"){return $("#filter-month").addclass("highlight-filter")}else if(this.time==="year"){return $("#filter-year").addclass("highlight-filter")}else if(this.time==="century"){return $("#filter-century").addclass("highlight-filter")}};return a}();window.Rankings=e=function(){function b(){this.filters=new a;this.maxed_song=-1;this.songsPerPage=$("tr.song-min").length;this.commentsPerSong=4;this.flag="normal";this.initialize()}b.prototype.initialize=function(){return this.initializeSongs(1,this.songsPerPage)};b.prototype.filt=function(a){return this.filters.filt(a)};b.prototype.nextComments=function(a){var b,c,d,e;c=false;if(c)console.log("Rankings.nextComments("+a+")");e=parseInt($("#commentIterator_"+a).val());b=this.commentsPerSong;d=e+this.commentsPerSong;$("#commentIterator_"+a).val(d);if(c){console.log("POSTS: ");console.log("lowerLimit: "+e);console.log("upperLimit: "+d);console.log("ytcode: "+$("#ytcode_"+a).val())}return $.post("ajax/nextCommentAjax.php",{lowerLimit:e,upperLimit:d,ytcode:$("#ytcode_"+a).val()},function(d){if(c)console.log(d);$("#max_"+a).find(".comment-display").html(d);if($("#max_"+a).find(".comment-p").length<b){return $("#max_"+a).find(".see-more-comments").addClass("hidden")}})};b.prototype.enableMoreSongsButton=function(){if($("tr.song-min").length>0&&$("tr.song-min").length%this.songsPerPage===0){$("#showMoreSongs").removeClass("hidden");return true}else{$("#showMoreSongs").addClass("hidden");return false}};b.prototype.changeTitle=function(a){console.log("Rankings.changeTitle("+a+")");return $("#rankings-title").text(a)};b.prototype.submitComment=function(a,b,c){var d,e;if(c==null)c=-1;d=false;if(d){console.log("User "+b+" commenting on "+c+": "+a)}if(a===""){return alert("Please enter a comment")}else if(b===""){return alert("Please enter a username to comment")}else{if(c!==-1){e=$("#ytcode_"+c).val()}else{e=$("#upload_yturl").val()}if(d)console.log("POSTS:");if(d)console.log(encodeURIComponent(b));if(d)console.log(encodeURIComponent(a));if(d)console.log("ytcode: "+e);return $.post("ajax/commentAjax.php",{user:encodeURIComponent(b),comment:encodeURIComponent(a),ytcode:e},function(a){if(d)console.log("Data: "+a);if(c!==-1){if(!$("#max_"+c).find(".no-comment").hasClass("hidden")){$("#max_"+c).find(".no-comment").addClass("hidden")}$("#max_"+c).find(".comment-display").prepend(a);return $("#max_"+c).find(".submit-comment").addClass("hidden")}})}};b.prototype.refreshTitle=function(){var a,b;if(this.filt("genre")==="all"){a="Tracks"}else{a=this.filt("genre")}if(a==="all"&&this.filt("time")==="new"){b="The Fresh List"}else if(this.filt("time")==="new"){b="The Freshest "+a}else{b="Top "+a+" of the "+this.filt("time")}return $("#rankings-title").text(b)};b.prototype.initializeSongs=function(a,b){var c,d,e;c=false;this.enableMoreSongsButton();if(c){console.log("Rankings.initializeComments("+a+","+b+") called")}e=[];for(d=a;a<=b?d<=b:d>=b;a<=b?d++:d--){if(c){console.log("Comments on Song "+d+": "+$("#max_"+d).find(".comment-p").length)}if($("#max_"+d).find(".comment-p").length<this.commentsPerSong){$("#max_"+d).find(".see-more-comments").addClass("hidden")}if($("#max_"+d).find(".comment-p").length===0){e.push($("#max_"+d).find(".comment-display").html('<p class="no-comment">No Comments. </p>'))}else{e.push(void 0)}}return e};b.prototype.search=function(a){var b,c;c=this.songsPerPage;b=this.commentsPerSong;a=a.trim();if(a.length===0){return alert("Please enter a search term")}else{console.log("search:"+a);this.changeTitle("Searching: "+a);this.flag="search";return $.post("ajax/searchAjax.php",{searchTerm:a,upperLimit:c},function(a){var d,e,f;$("#rankings-table").html(a);if($("tr.song-min").length>0&&$("tr.song-min").length%c===0){$("#showMoreSongs").removeClass("hidden")}else{$("#showMoreSongs").addClass("hidden")}if($("tr.song-min").length>0){f=[];for(d=1,e=$("tr.song-min").length;1<=e?d<=e:d>=e;1<=e?d++:d--){if($("#max_"+d).find(".comment-p").length===0){$("#max_"+d).find(".comment-display").html('<p class="no-comment">No Comments. </p>')}if($("#max_"+d).find(".comment-p").length<b){f.push($("#max_"+d).find(".see-more-comments").addClass("hidden"))}else{f.push(void 0)}}return f}})}};return b}();$(function(){var a,b,f;a=new c;b=new d;f=new e;$(document).on("click",".song-button",function(){var c;c=$(this).closest(".song").attr("id").split("_")[1];if($(this).hasClass("play-button")){b.playSong("genQ",c);return a.loadSongInRankings(c)}else if($(this).hasClass("queue-button")){b.userQ.append(c);return b.updateMinQueue()}});$(document).on("click",".next-song",function(){var c,d,e,f;c=false;if(c){console.log($("#min-queue").find(".queue-item:first-child").html())}e=$("#min-queue").find(".queue-item:first-child").attr("id");d=e.split("_")[1];f=e.split("_")[0];if(c)console.log("queue: "+f+", index: "+d);b.playSong(f,d);if(f==="genQ"){return a.loadSongInRankings(d)}else{d=d-1;return a.loadSongInfo(b.userQ.songs[d].title,b.userQ.songs[d].artist,b.userQ.songs[d].genre,b.userQ.songs[d].user)}});$(document).on("click",".previous-song",function(){return console.log("hihihihi")});$(document).on("click",".queue-item",function(){var c,d,e;c=false;if(c)console.log("queue-item clicked");d=$(this).attr("id").split("_")[1];e=$(this).attr("id").split("_")[0];if(c)console.log("queue: "+e+", index: "+d);b.playSong(e,d);if(e==="genQ"){return a.loadSongInRankings(d)}else{d=d-1;return a.loadSongInfo(b.userQ.songs[d].title,b.userQ.songs[d].artist,b.userQ.songs[d].genre,b.userQ.songs[d].user)}});$(".filter").click(function(){if($(this).hasClass("genre-filter")){f.filters.set("genre",$(this).html().toLowerCase())}else{f.filters.set("time",$(this).html().toLowerCase())}f.refreshTitle();return $.post("ajax/rankingsAjax.php",{genrefilter:f.filt("genre"),timefilter:f.filt("time")},function(a){$("#rankings-table").html(a);f.initialize();f.flag="normal";b.genQ.refresh();return b.updateMinQueue(true)})});$(document).on("click",".song",function(){var a,b,c;c=$(this).attr("id").split("_");a=c[1];b=c[0];if(b==="min"){if(f.maxed_song!==-1){$("#max_"+f.maxed_song).addClass("hidden");$("#min_"+f.maxed_song).removeClass("hidden")}else{}$("#min_"+a).addClass("hidden");$("#max_"+a).removeClass("hidden");return f.maxed_song=a}});$(document).on("click",".queue-min",function(){return $("#max-queue").addClass("hidden")});$(document).on("click","#queue-max",function(){return $("#max-queue").removeClass("hidden")});$(document).on("click","#showMoreSongs",function(){var a;a=$("tr.song-min").length;return $.post("ajax/showMoreSongsAjax.php",{genrefilter:f.filt("genre"),timefilter:f.filt("time"),searchTerm:$("#search-input").val(),flag:f.flag,lowerLimit:a,upperLimit:$("tr.song-min").length+f.songsPerPage},function(c){$("#rankings-table").append(c);f.initializeSongs(a,a+f.songsPerPage);b.genQ.refresh();return b.updateMinQ()})});$(document).on("click",".submit-comment",function(){var a;a=$(this).closest(".song").attr("id").split("_")[1];return f.submitComment($("#max_"+a).find(".comment-text").val(),$("#max_"+a).find(".comment-user").val(),a)});$(document).on("click",".see-more-comments",function(){var a;a=false;if(a)console.log("See-More-Comments Clicked");return f.nextComments($(this).closest(".song").attr("id").split("_")[1])});$(document).on("click",".vote-button",function(){var a,b,c;a=false;if(!$(this).hasClass("highlight-vote")){b=$(this).closest(".song").attr("id").split("_")[1];if($(this).attr("id")==="up-vote"){if(a)console.log("UpVote called on "+b);c="up";$("#max_"+b).find("#up-vote").addClass("highlight-vote");$("#max_"+b).find("#down-vote").removeClass("highlight-vote")}else if($(this).attr("id")==="down-vote"){if(a)console.log("DownVote called on "+b);c="down";$("#max_"+b).find("#down-vote").addClass("highlight-vote");$("#max_"+b).find("#up-vote").removeClass("highlight-vote")}else{if(a){console.log("Error: Something went wrong with the vote-buttons")}c="error"}return $.post("ajax/voteAjax.php",{result:c,ytcode:$("#ytcode_"+b).val(),score:$("#score_"+b).val(),ups:$("#ups_"+b).val(),downs:$("#downs_"+b).val()},function(c){if(a)console.log("Vote Success: "+c);$("#max_"+b).find(".score-container").html(c);return $("#min_"+b).find(".score-container").html(c)})}});$("#search-button").click(function(){return f.search($("#search-input").val())});$(document).on("click",".search-filter",function(){return f.search($(this).html())});return $("#upload_song").click(function(){var a;a=false;return $.post("ajax/uploadAjax.php",{ytcode:$("#upload_yturl").val(),title:$("#upload_title").val(),oldie:$("#upload_oldie").attr("checked"),artist:$("#upload_artist").val(),genre:$("#upload_genre").val(),user:$("#upload_user").val()},function(b){console.log("Upload Result: "+b);$("#upload-box-result").html(b);$("#upload-box-result").removeClass("hidden");if($("#upload-box-result").html().indexOf("Upload Failed")===-1){$("#upload-box-result").css("color","#33FF33");if(a)console.log("comment: "+$("#upload_comment").val());if($("#upload_comment").val()!==""){f.submitComment($("#upload_comment").val(),$("#upload_user").val(),-1)}$("#upload_yturl").val("");$("#upload_title").val("");$("#upload_artist").val("");return $("#upload_comment").val("")}else{return $("#upload-box-result").css("color","red")}})})})}).call(this)
